<!-- src/app/pages/ai-classification/ai-classification.html -->
<div class="page">
    <!-- HEADER -->
    <header class="page__header">
        <div>
            <h1 class="page__title">Ph√¢n Lo·∫°i CV</h1>
            <p class="page__subtitle">
                Upload CV c·ªßa ·ª©ng vi√™n, backend s·∫Ω tr√≠ch xu·∫•t n·ªôi dung, chu·∫©n h√≥a d·ªØ li·ªáu v√† d√πng AI (Gemini)
                ƒë·ªÉ so kh·ªõp v·ªõi c√°c Job Description trong h·ªá th·ªëng.
            </p>
            <p class="page__subtitle page__subtitle--meta">
                AI + Gemini ‚Ä¢ Graduation Project ‚Ä¢ Flow: Upload 1 CV ‚Üí AI ph√¢n t√≠ch ‚Üí G·ª£i √Ω & x·∫øp h·∫°ng c√°c job ph√π h·ª£p.
            </p>
        </div>


    </header>

    <!-- GRID 2 C·ªòT -->
    <div class="page__grid">
        <!-- LEFT: Upload -->
        <section class="card card--upload">
            <h2 class="card__title">1. Upload CV ƒë·ªÉ AI ƒë·ªçc & ph√¢n lo·∫°i</h2>
            <p class="card__sub card__sub--upload">
                H·ªó tr·ª£ <span class="fmt">PDF</span>, <span class="fmt">DOC/DOCX</span>, <span
                    class="fmt">JPG/PNG</span>.
                Sau khi upload, backend s·∫Ω tr√≠ch xu·∫•t text, chu·∫©n h√≥a d·ªØ li·ªáu v√† ch·∫°y AI ƒë·ªÉ so kh·ªõp v·ªõi
                t·∫•t c·∫£ v·ªã tr√≠ tuy·ªÉn d·ª•ng trong h·ªá th·ªëng.
            </p>
            <!-- Upload area -->
            <!-- Upload area -->
            <label class="upload-box__area">
                <input #fileInput type="file" multiple class="upload-box__input"
                    accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" (change)="onFilesChange($event, fileInput)" />

                <div class="upload-box__content">
                    <div class="tag-pill">
                        {{ selectedFileName || 'Ch·ªçn ho·∫∑c k√©o CV v√†o ƒë√¢y' }}
                    </div>

                    <div class="upload-box__text">
                        {{
                        selectedFileName
                        ? 'ƒê√£ ch·ªçn: ' + selectedFileName
                        : 'H·ªó tr·ª£ PDF, DOC/DOCX, JPG/PNG. Dung l∆∞·ª£ng < 10MB/file.' }} </div>
                    </div>
            </label>

            <!-- N√∫t ch·∫°y AI -->
            <div class="run-row">
                <button class="btn btn--primary" type="button" (click)="onRunMatching()"
                    [disabled]="!selectedFiles.length || isMatching">
                    <span *ngIf="!isMatching">üöÄ X·ª≠ L√≠ CV</span>
                    <span *ngIf="isMatching">ü§ñ AI ƒëang x·ª≠ l√Ω...</span>
                </button>

                <button class="btn btn--ghost" type="button" (click)="clearSelectedFiles()" [disabled]="isMatching">
                    üßπ X√≥a file
                </button>

                <span class="run-row__hint">
                    Flow: Upload CV ‚Üí Backend parse PDF/Word ‚Üí Chu·∫©n h√≥a d·ªØ li·ªáu ‚Üí G·ªçi Gemini ph√¢n t√≠ch ‚Üí
                    X·∫øp h·∫°ng c√°c job theo m·ª©c ƒë·ªô ph√π h·ª£p.
                </span>
            </div>


            <!-- Error -->
            <p *ngIf="errorMessage" class="error-text">
                {{ errorMessage }}
            </p>
        </section>

        <!-- RIGHT: K·∫æT QU·∫¢ CHI TI·∫æT -->
        <section class="card card--result">
            <ng-container *ngIf="selectedCandidate; else emptyResult">
                <div class="match-card__header">
                    <div>
                        <h2 class="card__title">
                            {{ selectedCandidate.name }}
                        </h2>
                        <p class="card__sub">
                            ƒê·ªÅ xu·∫•t: {{ selectedCandidate.recommendedJob }}
                        </p>
                        <div class="match-card__tags">
                            <span class="tag-pill" *ngFor="let t of matchTags">{{ t }}</span>
                        </div>
                    </div>

                    <div class="match-card__score-wrap">
                        <div class="match-card__score-label">M·ª©c ƒê·ªô Ph√π H·ª£p</div>
                        <div class="match-card__score-value">
                            {{ selectedCandidate.matchScore }}%
                        </div>
                        <div class="match-card__bar">
                            <div class="match-card__bar-fill" [style.width.%]="selectedCandidate.matchScore"></div>
                        </div>
                        <div class="match-card__status-row">
                            <span class="match-card__status-label">Tr·∫°ng th√°i</span>
                            <span class="badge" [ngClass]="{
    'badge--success': selectedCandidate.status === 'Suitable',
    'badge--warning': selectedCandidate.status === 'Potential',
    'badge--danger': selectedCandidate.status === 'NotFit'
  }">
                                {{ selectedCandidate.status }}
                            </span>
                        </div>

                    </div>
                </div>

                <!-- Summary t·ª´ AI -->
                <div *ngIf="matchSummary as summary" class="match-card__summary">
                    <p class="match-card__summary-title">T√≥m T·∫Øt T·ª´ AI</p>

                    <div *ngIf="summary.mainSkills.length" class="summary-row">
                        <div class="summary-label">K·ªπ nƒÉng:</div>
                        <div class="summary-value">{{ summary.mainSkills.join(', ') }}</div>
                    </div>

                    <div *ngIf="summary.mainDomains.length" class="summary-row">
                        <div class="summary-label">Lƒ©nh v·ª±c:</div>
                        <div class="summary-value">{{ summary.mainDomains.join(', ') }}</div>
                    </div>

                    <div *ngIf="summary.seniority" class="summary-row">
                        <div class="summary-label">C·∫•p ƒë·ªô:</div>
                        <div class="summary-value">{{ summary.seniority }}</div>
                    </div>
                </div>

            </ng-container>

            <!-- Empty state -->
            <!-- EMPTY STATE -->
            <ng-template #emptyResult>
                <div class="empty-state">
                    <!-- ROBOT -->
                    <div class="robot" [class.robot--thinking]="isMatching || isLoadingFromDb">
                        <div class="robot__head">
                            <div class="robot__eye"></div>
                            <div class="robot__eye"></div>
                        </div>
                        <div class="robot__body"></div>
                    </div>

                    <h3 class="empty-state__title">
                        {{ (isMatching || isLoadingFromDb) ? 'AI ƒëang ph√¢n t√≠ch CV...' : 'Ch∆∞a c√≥ k·∫øt qu·∫£ AI' }}
                    </h3>

                    <p class="empty-state__text">
                        <ng-container *ngIf="!isMatching">
                            H√£y upload m·ªôt CV, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông ph√¢n t√≠ch v√† g·ª£i √Ω c√¥ng vi·ªác ph√π h·ª£p nh·∫•t.
                        </ng-container>
                        <ng-container *ngIf="isMatching">
                            ƒêang tr√≠ch xu·∫•t n·ªôi dung CV, chu·∫©n h√≥a d·ªØ li·ªáu v√† so kh·ªõp v·ªõi Job Description...
                        </ng-container>
                    </p>

                    <!-- loading dots -->
                    <div *ngIf="isMatching || isLoadingFromDb" class="loading-dots">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            </ng-template>

        </section>
    </div>

    <!-- TABLE: X·∫øp h·∫°ng c√°c job -->
    <section class="card page__section--below" *ngIf="candidates.length">
        <div class="card__header">
            <div>
                <h2 class="card__title">K·∫øt Qu·∫£ AI So Kh·ªõp</h2>
                <p class="card__sub">
                    Danh s√°ch c√°c v·ªã tr√≠ ph√π h·ª£p ƒë∆∞·ª£c AI x·∫øp h·∫°ng t·ª´ cao ƒë·∫øn th·∫•p. Click v√†o m·ªôt d√≤ng ƒë·ªÉ xem
                    chi ti·∫øt b√™n tr√™n.
                </p>
            </div>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th>·ª®ng Vi√™n</th>
                    <th>V·ªã Tr√≠ ƒê·ªÅ Xu·∫•t</th>
                    <th>M·ª©c ƒê·ªô Ph√π H·ª£p</th>
                    <th>Tr·∫°ng Th√°i</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let c of candidates" (click)="onSelectCandidate(c)"
                    [class.table__row--selected]="c === selectedCandidate">
                    <td>{{ c.name }}</td>
                    <td>{{ c.recommendedJob }}</td>
                    <td>{{ c.matchScore }}%</td>
                    <td>
                        <span class="badge" [ngClass]="{
                'badge--success': c.status === 'Suitable',
                'badge--warning': c.status === 'Potential',
                'badge--danger': c.status === 'NotFit'
              }">
                            {{ statusLabel(c.status) }}
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
    </section>
</div>