<div class="page page--jobs">
    <header class="page__header">
        <div>
            <h1 class="page__title">Qu·∫£n L√Ω V·ªã Tr√≠ Tuy·ªÉn D·ª•ng</h1>
            <p class="page__subtitle">Qu·∫£n l√Ω danh s√°ch v·ªã tr√≠ tuy·ªÉn d·ª•ng ƒë·ªÉ AI so kh·ªõp v·ªõi CV.</p>
            <p class="page__subtitle page__subtitle--meta">
                Backend s·∫Ω l∆∞u JD v√†o MongoDB v√† d√πng cho b∆∞·ªõc <strong>AI matching</strong>.
            </p>
        </div>
    </header>

    <div class="jobs-layout">
        <!-- FORM -->
        <section class="card card--shadow">
            <div class="card__header">
                <h2 class="card__title">Th√™m Job m·ªõi</h2>
                <p class="card__sub">M√£ JD s·∫Ω ƒë∆∞·ª£c h·ªá th·ªëng t·ª± sinh khi b·∫°n l∆∞u Job.</p>
            </div>
            <div class="importbar">
                <div class="importbar__left">
                    <button type="button" class="btn btn--ghost" (click)="downloadTemplate()" [disabled]="importing">
                        T·∫£i template
                    </button>

                    <!-- input th·∫≠t: ·∫®N -->
                    <input #excelInput type="file" accept=".xlsx,.xls,.csv" class="importbar__file"
                        (change)="onPickExcel($event)" />

                    <button type="button" class="btn btn--ghost" (click)="excelInput.click()" [disabled]="importing">
                        Ch·ªçn file
                    </button>

                    <span class="importbar__filename" [class.muted]="!excelFileName">
                        {{ excelFileName || 'Ch∆∞a ch·ªçn file' }}
                    </span>
                </div>

                <div class="importbar__right">
                    <button type="button" class="btn btn--primary" (click)="importExcel()"
                        [disabled]="!excelFile || importing">
                        {{ importing ? 'ƒêang import‚Ä¶' : 'Import Excel' }}
                    </button>
                </div>
            </div>



            <div class="jobs-form">
                <!-- BASIC -->
                <div class="jobs-form__section jobs-form__section--basic">
                    <div class="jobs-form__section-title">Th√¥ng tin c∆° b·∫£n</div>

                    <div class="jobs-form__grid jobs-form__grid--basic">
                        <div class="jobs-form__field">
                            <label class="field__label">T√™n v·ªã tr√≠</label>
                            <input class="field__input field__input--lg" type="text"
                                placeholder="VD: Software Engineer (Web)" [(ngModel)]="newJob.title" />
                        </div>

                        <div class="jobs-form__field">
                            <label class="field__label">C·∫•p ƒë·ªô</label>
                            <select class="field__input" [(ngModel)]="newJob.level">
                                <option value="">-- Ch·ªçn --</option>
                                <option value="Intern">Intern</option>
                                <option value="Junior">Junior</option>
                                <option value="Middle">Middle</option>
                                <option value="Senior">Senior</option>
                                <option value="Manager">Manager</option>
                            </select>
                        </div>

                        <div class="jobs-form__field">
                            <label class="field__label">H√¨nh th·ª©c</label>
                            <select class="field__input" [(ngModel)]="newJob.type">
                                <option value="">-- Ch·ªçn --</option>
                                <option value="Full-time">Full-time</option>
                                <option value="Part-time">Part-time</option>
                                <option value="Contract">Contract</option>
                                <option value="Internship">Internship</option>
                            </select>
                        </div>
                    </div>

                    <p class="jobs-form__hint">
                        Level + h√¨nh th·ª©c s·∫Ω gi√∫p AI matching ph√¢n lo·∫°i CV ch√≠nh x√°c h∆°n.
                    </p>
                </div>

                <!-- DETAIL -->
                <div class="jobs-form__section">
                    <div class="jobs-form__section-title">Chi ti·∫øt JD</div>

                    <div class="jobs-form__grid jobs-form__grid--2col">
                        <div class="jobs-form__field">
                            <label class="field__label">
                                K·ªπ nƒÉng y√™u c·∫ßu <span class="field__label-note">(skillsRequired)</span>
                            </label>
                            <textarea class="field__textarea" rows="3"
                                placeholder="VD: Node.js, Express.js, MongoDB, REST API, Git‚Ä¶"
                                [(ngModel)]="newJob.skillsRequired"></textarea>
                        </div>

                        <div class="jobs-form__field">
                            <label class="field__label">
                                Kinh nghi·ªám y√™u c·∫ßu <span class="field__label-note">(experienceRequired)</span>
                            </label>
                            <textarea class="field__textarea" rows="3"
                                placeholder="VD: 1‚Äì2 nƒÉm l√†m vi·ªác, t·ª´ng tham gia d·ª± √°n th·ª±c t·∫ø‚Ä¶"
                                [(ngModel)]="newJob.experienceRequired"></textarea>
                        </div>

                        <div class="jobs-form__field">
                            <label class="field__label">
                                H·ªçc v·∫•n y√™u c·∫ßu <span class="field__label-note">(educationRequired)</span>
                            </label>
                            <textarea class="field__textarea" rows="3"
                                placeholder="VD: T·ªët nghi·ªáp ng√†nh CNTT ho·∫∑c li√™n quan‚Ä¶"
                                [(ngModel)]="newJob.educationRequired"></textarea>
                        </div>

                        <div class="jobs-form__field">
                            <label class="field__label">
                                M√¥ t·∫£ c√¥ng vi·ªác <span class="field__label-note">(description)</span>
                            </label>
                            <textarea class="field__textarea" rows="3"
                                placeholder="M√¥ t·∫£ nhi·ªám v·ª• ch√≠nh, team, stack s·ª≠ d·ª•ng‚Ä¶"
                                [(ngModel)]="newJob.description"></textarea>
                        </div>
                    </div>
                </div>

                <div class="jobs-form__footer">
                    <div class="jobs-form__actions">
                        <button type="button" class="btn btn--ghost" (click)="loadJobs()">
                            Refresh
                        </button>

                        <button type="button" class="btn btn--primary" (click)="onSaveJob()" [disabled]="isSaving">
                            {{ isSaving ? 'ƒêang l∆∞u‚Ä¶' : 'T·∫°o Job' }}
                        </button>
                    </div>
                </div>

                <!-- ‚úÖ D√ÅN NGAY ·ªû ƒê√ÇY -->
                <div class="import-result" *ngIf="importMessage || importErrors.length">
                    <p class="import-result__msg" *ngIf="importMessage">{{ importMessage }}</p>

                    <div class="import-result__errors" *ngIf="importErrors.length">
                        <div class="import-result__title">L·ªói import:</div>
                        <ul>
                            <li *ngFor="let e of importErrors">
                                <span class="mono">Row {{ e.row ?? '‚Äî' }}</span> ‚Äî {{ e.message }}
                            </li>
                        </ul>
                    </div>
                </div>

                <p *ngIf="saveMessage" class="jobs-form__status">{{ saveMessage }}</p>
                <p *ngIf="errorMessage" class="error-text jobs-form__error">{{ errorMessage }}</p>

            </div>
        </section>

        <!-- LIST -->
        <section class="card card--shadow">
            <div class="card__header jobs-list__header">
                <div>
                    <h2 class="card__title">Danh s√°ch JD</h2>
                    <p class="card__sub">C√≥ th·ªÉ xo√° khi JD h·∫øt hi·ªáu l·ª±c.</p>
                </div>

                <div class="jobs-list__chips" *ngIf="jobs.length">
                    <span class="chip chip--primary">T·∫•t c·∫£ JD</span>
                    <span class="chip chip--soft">T·ªïng: {{ jobs.length }} JD</span>
                </div>
            </div>

            <ng-container *ngIf="isLoading; else jobsOrEmpty">
                <div class="empty-state empty-state--inline">
                    <div class="spinner"></div>
                    <p class="empty-state__text">ƒêang t·∫£i danh s√°ch JD‚Ä¶</p>
                </div>
            </ng-container>

            <ng-template #jobsOrEmpty>
                <ng-container *ngIf="filteredJobs.length; else emptyJobs">
                    <div class="jobs-table-wrapper">
                        <table class="table table--jd">
                            <thead>
                                <tr>
                                    <th class="col-code">M√£ JD</th>
                                    <th class="col-title">T√™n v·ªã tr√≠</th>
                                    <th class="col-level">Level</th>
                                    <th class="col-type">H√¨nh th·ª©c</th>
                                    <th class="col-skills">Skills (t√≥m t·∫Øt)</th>
                                    <th class="col-created">Created at</th>
                                    <th class="col-actions">Actions</th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr *ngFor="let j of filteredJobs">
                                    <td class="table__mono col-code">{{ j.code || '‚Äî' }}</td>
                                    <td class="col-title">{{ j.title }}</td>

                                    <td class="col-level">
                                        <span class="badge" [class.badge--muted]="!j.level">
                                            {{ getLevelLabel(j.level) }}
                                        </span>
                                    </td>

                                    <td class="col-type">
                                        <span class="badge badge--soft" [class.badge--muted]="!j.type">
                                            {{ getTypeLabel(j.type) }}
                                        </span>
                                    </td>

                                    <td class="col-skills">
                                        {{ (j.skillsRequired || '') | slice:0:90 }}{{ (j.skillsRequired || '').length >
                                        90 ? '‚Ä¶' : '' }}
                                    </td>

                                    <td class="table__mono col-created">
                                        {{ j.createdAt | date:'dd/MM/yyyy, HH:mm' }}
                                    </td>

                                    <td class="col-actions">
                                        <button type="button" class="link-btn link-btn--danger"
                                            (click)="onDeleteJob(j)">
                                            Xo√°
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="jobs-pagination" *ngIf="totalPages > 1">
                        <button class="btn btn--ghost" type="button" (click)="goPrevPage()"
                            [disabled]="currentPage === 1">
                            Tr∆∞·ªõc
                        </button>
                        <span class="jobs-pagination__info">Trang {{ currentPage }} / {{ totalPages }}</span>
                        <button class="btn btn--ghost" type="button" (click)="goNextPage()"
                            [disabled]="currentPage === totalPages">
                            Sau
                        </button>
                    </div>
                </ng-container>

                <ng-template #emptyJobs>
                    <div class="empty-state">
                        <div class="empty-state__icon">üìÑ</div>
                        <h3 class="empty-state__title">Ch∆∞a c√≥ JD n√†o</h3>
                        <p class="empty-state__text">H√£y t·∫°o m·ªôt Job ·ªü form b√™n tr√™n ƒë·ªÉ test AI matching.</p>
                    </div>
                </ng-template>
            </ng-template>
        </section>
    </div>
</div>